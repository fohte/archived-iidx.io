[
  {
    "name": "backend",
    "image": "iidxio/backend",
    "environment": [
      { "name": "APP_DATABASE_PASSWORD", "value": "${db_password}" },
      {
        "name": "FIREBASE_API_KEY",
        "value": "AIzaSyCO-OMhKvm89aZj4-1HTZOc0PTnb5aUtxQ"
      },
      { "name": "FIREBASE_AUTH_DOMAIN", "value": "iidx-io.firebaseapp.com" },
      { "name": "FIREBASE_PROJECT_ID", "value": "iidx-io" },
      { "name": "MYSQL_HOST", "value": "${db_host}" },
      { "name": "MYSQL_PORT", "value": "3306" },
      { "name": "RAILS_LOG_TO_STDOUT", "value": "true" },
      { "name": "REDIS_HOST", "value": "redis" },
      { "name": "REDIS_PORT", "value": "6379" },
      { "name": "SECRET_KEY_BASE", "value": "${secret_key_base}" }
    ],
    "links": ["redis"],
    "memoryReservation": 256,
    "portMappings": [
      {
        "containerPort": 3000,
        "hostPort": 5000,
        "protocol": "tcp"
      }
    ],
    "logConfiguration": {
      "logDriver": "awslogs",
      "options": {
        "awslogs-group": "${log_group_name}",
        "awslogs-region": "${log_group_region}",
        "awslogs-stream-prefix": "web"
      }
    }
  },
  {
    "name": "frontend",
    "image": "iidxio/frontend",
    "environment": [
      { "name": "PRIVATE_API_URL", "value": "http://backend:3000/graphql" },
      { "name": "PUBLIC_API_URL", "value": "https://api.iidx.io/graphql" },
      {
        "name": "FIREBASE_API_KEY",
        "value": "AIzaSyCO-OMhKvm89aZj4-1HTZOc0PTnb5aUtxQ"
      },
      { "name": "FIREBASE_AUTH_DOMAIN", "value": "iidx-io.firebaseapp.com" },
      { "name": "FIREBASE_PROJECT_ID", "value": "iidx-io" }
    ],
    "links": ["backend"],
    "memoryReservation": 256,
    "portMappings": [
      {
        "containerPort": 3000,
        "hostPort": 3000,
        "protocol": "tcp"
      }
    ],
    "logConfiguration": {
      "logDriver": "awslogs",
      "options": {
        "awslogs-group": "${log_group_name}",
        "awslogs-region": "${log_group_region}",
        "awslogs-stream-prefix": "web"
      }
    }
  },
  {
    "name": "redis",
    "image": "redis:4.0.11-stretch",
    "memoryReservation": 128,
    "logConfiguration": {
      "logDriver": "awslogs",
      "options": {
        "awslogs-group": "${log_group_name}",
        "awslogs-region": "${log_group_region}",
        "awslogs-stream-prefix": "web"
      }
    }
  }
]
